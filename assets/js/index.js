jQuery(function(a){var t=0,s=null,e=ajaxurl+"?action=get_chat_history",i=ajaxurl+"?action=send_chat_message";setInterval(function(){var t,s;t=ajaxurl+"?action=get_new_mssgs",a.ajax({type:"post",datatype:"json",url:t,success:function(t){if(data=a.parseJSON(t),null!=data)for(var s=0;s<data.length;s++){var e=data[s];null!=e[0]&&a(".chat-msg-notification-"+e[0].sender_id).addClass("active")}}}),s=ajaxurl+"?action=get_user_status",a.ajax({type:"post",datatype:"json",url:s,success:function(t){if(data=a.parseJSON(t),null!=data)for(var s=0;s<data.length;s++)data[s].activeuser&&(a(".chat-msg-status-"+data[s].activeuser).removeClass("offline"),a(".chat-msg-status-"+data[s].activeuser).addClass("active")),data[s].offline&&(a(".chat-msg-status-"+data[s].offline).removeClass("active"),a(".chat-msg-status-"+data[s].offline).addClass("offline"))}})},5e3);setInterval(function(){if("block"==a(".chat-head").css("display")){if(user_id=a("#send-chat-button").attr("data-usertosend"),e=a("#send-chat-button").attr("data-getuserhistory"),a.active>=1)return 0;n(user_id,e)}},3e3);function n(e,i){a(".chat-head").css("display");return null!=s&&(s.abort(),s=null),a(".chat-head").show(1e3),s=a.ajax({type:"post",datatype:"json",url:i,data:{user_id:e},success:function(s){if(s&&s.length>0){if(data=a.parseJSON(s),t<data.length){a(".previous-message-chat-section").html("");for(var i=0;i<data.length;i++){var n=data[i];"not-found"==n.error&&a(".previous-message-chat-section").html("<span>Let us Chat :)</span>"),n.sender_id!=e?a("#chat-head-"+e+" .previous-message-chat-section").append('<div class="chat-message-right">'+c(n.message)+'</div><span class="chat-mssg-time-right">'+n.date_time+"</span>"):a("#chat-head-"+e+" .previous-message-chat-section").append('<div class="chat-message-left">'+c(n.message)+'</div><span class="chat-mssg-time-left">'+n.date_time+"</span>")}a(".previous-message-chat-section").append('<div class="spinner"></div>'),a(".previous-message-chat-section").is(":hover")||a(".previous-message-chat-section").scrollTop(a(".previous-message-chat-section")[0].scrollHeight),a(".spinner").hide(),t=data.length}}else a(".previous-message-chat-section").html("<span>Error occured :(</span>")}}),0}function c(a){var t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#039;":"'"};return a.replace(/&amp;|&lt;|&gt;|&quot;|&#039;/g,function(a){return t[a]})}function o(t,c){var o;mssgcheck=t.trim(),o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"},t=t.replace(/[&<>"']/g,function(a){return o[a]}),""!=mssgcheck&&(null!=s&&(s.abort(),s=null),a.ajax({type:"post",datatype:"json",url:i,data:{user_id:c,mssg:t},beforeSend:function(){a("#chat-head-"+c+" .previous-message-chat-section").append('<div class="chat-message-right">'+t+'</div><span class="chat-mssg-time-right error-mssg-chat" style="display:none;">can\'t send empty mssg</span><span class="chat-mssg-time-right sending-mssg">Sending....</span>'),a(".previous-message-chat-section").scrollTop(a(".previous-message-chat-section")[0].scrollHeight)},success:function(t){a(".sending-mssg").css("display","none"),n(c,e)}}))}a(".open-chat-box").click(function(c){c.preventDefault(),a(".chat-head").hide(500);var o,r,d=a(this).attr("id"),h=a(this).attr("data-providername");a(".chat-msg-notification-"+d).removeClass("active"),null!=s&&(s.abort(),s=null),r='<div class="chat-head" id = "chat-head-'+(o=d)+'">',r+='<div class="cross-chat"><i class="fa fa-times shut-off-chat" aria-hidden="true"></i></div>',r+='<div class="chat-content-section">',r+='<div class="chat-contact-info">'+h+"</div>",r+='<div class="previous-message-chat-section"></div></div>',r+='<div class="writting-section">',r+='<textarea id="chat-mssgs"></textarea><button id="send-chat-button" class="btn btn-primary" data-getuserhistory="'+e+'" data-usertosend="'+o+'" data-urlprovider="'+i+'">Send</button></div></div>',a("#chat-space").html(r),t=0,n(d,e)}),a("h3#multichatuserstitle").click(function(){a("#allusers").toggle(500),a("span#multichathub").hasClass("minus")?a("span#multichathub").removeClass("minus"):a("span#multichathub").addClass("minus")}),a(document).ajaxStop(function(){a(".shut-off-chat").click(function(){a(".chat-head").hide(500),a(".chat-head").css("display","none")}),a("#send-chat-button").unbind().click(function(){o(a("#chat-mssgs").val(),a(this).attr("data-usertosend")),a("#chat-mssgs").val("")}),a("#chat-mssgs").keypress(function(t){if(13==t.which){var s=a(this).siblings("button").attr("data-usertosend");o(a(this).val(),s),a(this).val("")}})})});